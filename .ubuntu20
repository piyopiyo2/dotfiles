#!/usr/bash

PYTHON_VERSION="3.9.2"

sudo apt update sudo apt -y upgrade

sudo apt-get install -y \
build-essential \
libssl-dev \
zlib1g-dev \
libbz2-dev \
libreadline-dev \
libsqlite3-dev \
wget \
curl \
llvm \
libncurses5-dev \
libncursesw5-dev \
xz-utils \
tk-dev \
libffi-dev \
liblzma-dev \
python-openssl \
git \
vim \
tree

# pyenv
if [ ! -d ~/.pyenv ]; then
    git clone https://github.com/pyenv/pyenv.git ~/.pyenv
    echo 'export PYENV_ROOT="$HOME/.pyenv"' >> ~/.bashrc
    echo 'export PATH="$PYENV_ROOT/bin:$PATH"' >> ~/.bashrc
    echo -e 'if command -v pyenv 1>/dev/null 2>&1; then\n  eval "$(pyenv init -)"\nfi' >> ~/.bashrc
    exec "$SHELL"
    pyenv install $PYTHON_VERSION
fi
pyenv global $PYTHON_VERSION

# git
git config --global user.name "piyopiyo2"
git config --global user.email "79834290+piyopiyo2@users.noreply.github.com"
git config --global core.editor "vim"
git config --global core.filemode false

# vim
if [ ! -f ~/.vimrc ]; then
    wget https://raw.githubusercontent.com/piyopiyo2/dotfiles/master/.vimrc -O ~/.vimrc
fi

# Install cuda 11.2
# See https://developer.nvidia.com/cuda-downloads
if [ ! -d /usr/local/cuda-11.2 ]; then
    wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pinsudo
    mv cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600
    wget https://developer.download.nvidia.com/compute/cuda/11.2.1/local_installers/cuda-repo-ubuntu2004-11-2-local_11.2.1-460.32.03-1_amd64.deb
    sudo dpkg -i cuda-repo-ubuntu2004-11-2-local_11.2.1-460.32.03-1_amd64.deb
    sudo apt-key add /var/cuda-repo-ubuntu2004-11-2-local/7fa2af80.pub
    sudo apt-get update
    sudo apt-get -y install cuda
    rm cuda-repo-ubuntu2004-11-2-local_11.2.1-460.32.03-1_amd64.deb
fi

# Install python libraries
pip install --upgrade pip
pip install \
numpy \
opencv-python \
pytest \
flake8 \
isort \
black \
mypy

# Install torch==1.8.0 (WARNING: not stable version)
pip install --pre torch torchvision torchaudio -f https://download.pytorch.org/whl/nightly/cu110/torch_nightly.html
